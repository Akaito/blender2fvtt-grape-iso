{
  "_id": "tZ6P3VnDG01IXp9U",
  "name": "blender2grape-iso",
  "type": "script",
  "sort": 100001,
  "flags": {
    "exportSource": {
      "world": "5e-srd",
      "system": "dnd5e",
      "coreVersion": "0.7.8",
      "systemVersion": "1.1.1"
    }
  },
  "scope": "global",
  "command": "const gridSize = canvas.scene.data.grid;\nconst foundrySceneOrigin = [\n  Math.floor((canvas.scene.data.width\n    + canvas.scene.data.padding*2*canvas.scene.data.width) / 2),\n  Math.floor((canvas.scene.data.height +\n    canvas.scene.data.padding*2*canvas.scene.data.height) / 2),\n];\nmain();\n\n\nasync function main() {\n  let jsn = get_blender_jsn();\n  // Walls\n  let newWalls = [];\n  jsn['blenderWalls']?.map(wall => {newWalls.push.apply(newWalls, blenderWall2FoundryWalls(wall));});\n  console.log('newWalls: ', newWalls);\n  await canvas.scene.createEmbeddedEntity('Wall', newWalls);\n  canvas.walls.activate();  // switch to walls layer\n\n  // Tiles\n  let newTiles = [];\n  jsn['blenderWalls']?.forEach(wall => {newTiles.push(blenderWall2Tile(wall));});\n  console.log('newTiles: ', newTiles);\n  await canvas.scene.createEmbeddedEntity('Tile', newTiles);\n  //let w = canvas.walls.filter(w => w.flags?.blender2grapeiso?.blenderObjectName === 'wall.001');\n  //console.log(w);\n}\n\n\n\n\n// Flip x and y from the Blender export.\n// This is kind of a hack.\n// Blender's camera is assumed to be looking down neg-x, pos-y.\n// Foundry in Grape's isometric is looking down pos-x, neg-y.\nfunction blenderWall2FoundryWalls(blenderWallJson) {\n  let result = [];\n  blenderWallJson?.foundryWalls?.forEach(wallJson => {\n    let sense = CONST.WALL_SENSE_TYPES.NORMAL;\n    if (wallJson['isFrontFacing'] !== true)\n      sense = CONST.WALL_SENSE_TYPES.NONE;\n    result.push({\n      c: [\n        foundrySceneOrigin[0] + wallJson.a[1] * gridSize,\n        foundrySceneOrigin[1] + wallJson.a[0] * gridSize,\n        foundrySceneOrigin[0] + wallJson.b[1] * gridSize,\n        foundrySceneOrigin[1] + wallJson.b[0] * gridSize\n      ],\n      sense: sense,\n      flags: {\n        blender2grapeiso: {\n          blenderObjectName: blenderWallJson.blenderObjectName,\n        }\n      },\n    });\n  });\n  return result;\n}\n\n\nfunction blenderWall2Tile(blenderWallJson) {\n  //console.log(blenderWallJson);\n  return {\n    img: 'icons/svg/wall-direction.svg',\n    width: 50,\n    height: 50,\n    x: foundrySceneOrigin[0] + blenderWallJson.foundryWalls[0].a[1] * gridSize,\n    y: foundrySceneOrigin[1] + blenderWallJson.foundryWalls[0].a[0] * gridSize,\n    z: 300,\n    hidden: false,\n    locked: false,\n    flags: {\n      blender2grapeiso: {\n        blenderObjectName: blenderWallJson['blenderObjectName'],\n      },\n    },\n  };\n}\n\n\nasync function createTile(blenderWallJson) {\n  canvas.scene.createEmbeddedEntity('Tile', {\n    'img': 'icons/svg/wall-direction.svg',\n    'width': 50,\n    'height': 50,\n    'x': 1000,\n    'y': 1000,\n    'z': 300,\n    'hidden': false,\n    'locked': false,\n    'flags': {\n      blender2grapeiso: {\n        'blenderObjectName': blenderWallJson['blenderObjectName'],\n      }\n    },\n  }).await;\n}\n\n\nasync function hookTile(blenderWallJson, foundryWallId) {\n}\n\n\nfunction get_blender_jsn() {\n  return {\n  \"blenderWalls\": [\n    {\n      \"blenderObjectName\": \"wall.003\",\n      \"foundryWalls\": [\n        {\n          \"a\": [\n            6.0,\n            1.0,\n            0.0\n          ],\n          \"b\": [\n            6.0,\n            0.0,\n            0.0\n          ],\n          \"isFrontFacing\": false\n        },\n        {\n          \"a\": [\n            10.0,\n            1.0,\n            0.0\n          ],\n          \"b\": [\n            6.0,\n            1.0,\n            0.0\n          ],\n          \"isFrontFacing\": false\n        },\n        {\n          \"a\": [\n            10.0,\n            0.0,\n            0.0\n          ],\n          \"b\": [\n            10.0,\n            1.0,\n            0.0\n          ],\n          \"isFrontFacing\": true\n        },\n        {\n          \"a\": [\n            6.0,\n            0.0,\n            0.0\n          ],\n          \"b\": [\n            10.0,\n            0.0,\n            0.0\n          ],\n          \"isFrontFacing\": true\n        }\n      ]\n    },\n    {\n      \"blenderObjectName\": \"wall.001\",\n      \"foundryWalls\": [\n        {\n          \"a\": [\n            0.0,\n            1.0,\n            0.0\n          ],\n          \"b\": [\n            0.0,\n            0.0,\n            0.0\n          ],\n          \"isFrontFacing\": false\n        },\n        {\n          \"a\": [\n            4.0,\n            1.0,\n            0.0\n          ],\n          \"b\": [\n            0.0,\n            1.0,\n            0.0\n          ],\n          \"isFrontFacing\": false\n        },\n        {\n          \"a\": [\n            4.0,\n            0.0,\n            0.0\n          ],\n          \"b\": [\n            4.0,\n            1.0,\n            0.0\n          ],\n          \"isFrontFacing\": true\n        },\n        {\n          \"a\": [\n            0.0,\n            0.0,\n            0.0\n          ],\n          \"b\": [\n            4.0,\n            0.0,\n            0.0\n          ],\n          \"isFrontFacing\": true\n        }\n      ]\n    },\n    {\n      \"blenderObjectName\": \"wall.002\",\n      \"foundryWalls\": [\n        {\n          \"a\": [\n            -1.0,\n            -4.0,\n            0.0\n          ],\n          \"b\": [\n            0.0,\n            -4.0,\n            0.0\n          ],\n          \"isFrontFacing\": true\n        },\n        {\n          \"a\": [\n            -1.0,\n            0.0,\n            0.0\n          ],\n          \"b\": [\n            -1.0,\n            -4.0,\n            0.0\n          ],\n          \"isFrontFacing\": false\n        },\n        {\n          \"a\": [\n            0.0,\n            0.0,\n            0.0\n          ],\n          \"b\": [\n            -1.0,\n            0.0,\n            0.0\n          ],\n          \"isFrontFacing\": false\n        },\n        {\n          \"a\": [\n            0.0,\n            -4.0,\n            0.0\n          ],\n          \"b\": [\n            0.0,\n            0.0,\n            0.0\n          ],\n          \"isFrontFacing\": true\n        }\n      ]\n    },\n    {\n      \"blenderObjectName\": \"wall.weird\",\n      \"foundryWalls\": [\n        {\n          \"a\": [\n            2.903578,\n            -4.473557,\n            -0.186482\n          ],\n          \"b\": [\n            2.010673,\n            -6.263172,\n            -0.186482\n          ],\n          \"isFrontFacing\": false\n        },\n        {\n          \"a\": [\n            3.385627,\n            -5.647088,\n            -0.186482\n          ],\n          \"b\": [\n            2.903578,\n            -4.473557,\n            -0.186482\n          ],\n          \"isFrontFacing\": true\n        },\n        {\n          \"a\": [\n            2.010673,\n            -6.263172,\n            -0.186482\n          ],\n          \"b\": [\n            3.035263,\n            -6.450493,\n            -0.186482\n          ],\n          \"isFrontFacing\": true\n        },\n        {\n          \"a\": [\n            3.035263,\n            -6.450493,\n            -0.186482\n          ],\n          \"b\": [\n            3.385627,\n            -5.647088,\n            -0.186482\n          ],\n          \"isFrontFacing\": true\n        }\n      ]\n    },\n    {\n      \"blenderObjectName\": \"wall.concave\",\n      \"foundryWalls\": [\n        {\n          \"a\": [\n            6.830998,\n            -2.267165,\n            -0.186482\n          ],\n          \"b\": [\n            6.830998,\n            -4.267165,\n            -0.186482\n          ],\n          \"isFrontFacing\": false\n        },\n        {\n          \"a\": [\n            7.497692,\n            -3.792273,\n            -0.186482\n          ],\n          \"b\": [\n            6.830998,\n            -2.267165,\n            -0.186482\n          ],\n          \"isFrontFacing\": true\n        },\n        {\n          \"a\": [\n            6.830998,\n            -4.267165,\n            -0.186482\n          ],\n          \"b\": [\n            8.830998,\n            -4.267165,\n            -0.186482\n          ],\n          \"isFrontFacing\": true\n        },\n        {\n          \"a\": [\n            8.830998,\n            -4.267165,\n            -0.186482\n          ],\n          \"b\": [\n            7.497692,\n            -3.792273,\n            -0.186482\n          ],\n          \"isFrontFacing\": false\n        }\n      ]\n    }\n  ]\n}\n}",
  "author": "2pwDDMtPZQq5dX12",
  "img": "icons/svg/castle.svg",
  "actorIds": []
}