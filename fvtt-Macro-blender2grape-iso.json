{
  "_id": "tZ6P3VnDG01IXp9U",
  "name": "blender2grape-iso",
  "type": "script",
  "sort": 100001,
  "flags": {
    "exportSource": {
      "world": "5e-srd",
      "system": "dnd5e",
      "coreVersion": "0.7.8",
      "systemVersion": "1.1.1"
    }
  },
  "scope": "global",
  "command": "let gridSize = canvas.scene.data.grid;\nlet foundrySceneOrigin = [\n  Math.floor((canvas.scene.data.width\n    + canvas.scene.data.padding*2*canvas.scene.data.width) / 2),\n  Math.floor((canvas.scene.data.height +\n    canvas.scene.data.padding*2*canvas.scene.data.height) / 2),\n];\nlet jsn = get_blender_jsn();\njsn['walls']?.forEach(wall => importBlenderWall(wall));\ncanvas.walls.activate();  // switch to walls layer\n\n\nfunction importBlenderWall(wallJson) {\n  //console.log('importing wall:', wallJson);\n  let farPoint = [wallJson['farPoint'][0],\n    wallJson['farPoint'][1]];\n  let a = [wallJson['origin'][0],\n    wallJson['origin'][1]];\n  let b = [a[0], farPoint[1]];\n  let c = [farPoint[0], farPoint[1]];\n  let d = [farPoint[0], a[1]];\n  makeObjectWalls(a, b, c, d);\n}\n\n\nfunction makeObjectWalls(a, b, c, d) {\n  makeFoundryWall(foundrySceneOrigin, a, b);\n  makeFoundryWall(foundrySceneOrigin, b, c);\n  makeFoundryWall(foundrySceneOrigin, c, d);\n  makeFoundryWall(foundrySceneOrigin, d, a);\n}\n\n\nfunction makeFoundryWall(originPos, begin, end) {\n  // Flip x and y from the Blender export.\n  // This is kind of a hack.\n  // Blender's camera is assumed to be looking down neg-x, neg-y.\n  // Foundry in Grape's isometric is looking down pos-x, pos-y.\n  canvas.scene.createEmbeddedEntity(\"Wall\", {\n    c: [\n      foundrySceneOrigin[0] + begin[1] * gridSize,\n      foundrySceneOrigin[1] + begin[0] * gridSize,\n      foundrySceneOrigin[0] + end[1] * gridSize,\n      foundrySceneOrigin[1] + end[0] * gridSize],\n  });\n}\n\n\nfunction get_blender_jsn() {\n  return {\n  \"walls\": [\n    {\n      \"farPoint\": [\n        10.0,\n        1.0,\n        4.0\n      ],\n      \"name\": \"wall.003\",\n      \"origin\": [\n        6.0,\n        0.0,\n        0.0\n      ]\n    },\n    {\n      \"farPoint\": [\n        4.0,\n        1.0,\n        4.0\n      ],\n      \"name\": \"wall.001\",\n      \"origin\": [\n        0.0,\n        0.0,\n        0.0\n      ]\n    },\n    {\n      \"farPoint\": [\n        -0.999999,\n        0.0,\n        4.0\n      ],\n      \"name\": \"wall.002\",\n      \"origin\": [\n        0.0,\n        -4.0,\n        0.0\n      ]\n    }\n  ]\n}\n}",
  "author": "2pwDDMtPZQq5dX12",
  "img": "icons/svg/castle.svg",
  "actorIds": []
}